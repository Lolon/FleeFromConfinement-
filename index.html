<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>Flee From Confinement</title>
  <script src="aframe-v0.7.1.js"></script>
  <script src="aframe-animation-component.js"></script>
  <script src="aframe-layout-component.js"></script>
  <script src="aframe-event-set-component.js"></script>
  <script src="nunjucks.js"></script>
  <script src="aframe-template-component.js"></script>
</head>

<body>

<a-scene>
  <a-assets>
    <img id="wall" src="assets/walls.png">
    <img id="floor" src="assets/floor.png">
    <img id="ceiling" src="assets/ceiling.png">
    <img id="door" src="assets/door.png">
    <img id="manhole" src="assets/manhole.png">
    <img id="wood" src="assets/wood.png">
    <img id="key" src="assets/key.png">


  </a-assets>

  <!--the sky! --><a-sky color="#6EBAA7"></a-sky>
  <!--the basic room with lights--> <a-plane color="#CCC" height="10" width="10" rotation="-90 0 0" src="#floor"></a-plane>
                        <a-plane color="#CCC" height="10" width="10" position="0 7 0" rotation="90 0 0" src="#ceiling"></a-plane>
                        <a-plane color="#CCC" height="7" width="10" position="0 3.5 -5" material="src: #wall" ></a-plane>
                        <a-plane color="#CCC" height="7" width="10" position="0 3.5 5" rotation="0 180 0" material="src: #wall"></a-plane>
                        <a-plane color="#CCC" height="7" width="10" position="-5 3.5 0" rotation="0 90 0" material="src: #wall"></a-plane>
                        <a-plane color="#CCC" height="7" width="10" position="5 3.5 0" rotation="0 -90 0" material="src: #wall"></a-plane>
                        <a-light tpe="ambient" color="#1e261b" position="0 -0.466 0" light="intensity:0.5;type:ambient"></a-light>
                        <a-light tpe="point" color="##fcf6c7" intensity="0.5" decay="1" distance="7" position="0 4.544 0" light="decay:1.54;distance:7.39;intensity:1;type:point;color:#83861a"></a-light>

<!-- all the objects -->
<a-entity position="0 2.108 -5.409" id="door" geometry="width:3;height:4.32" material="roughness:0.54;src: #door" class="scene"></a-entity>
<a-entity position="-1.616 0.394 3.521" id="bed" geometry="width:6.73;depth:2.98" material="roughness:1;color:#8486ec"></a-entity>
<a-entity position="-3.815 -0.44 -3.87" id="manhole" geometry="primitive:cylinder" material="src: #manhole; opacity: 0.9; emmisive:#0c0c0c" class="scene"></a-entity>
<a-entity position="3.841 0.43 3.878" id="table" geometry="height:1.73;depth:2.01;width:2" material="src: #wood"></a-entity>
<a-entity position="3.792 1.88 3.82" id="lamp" geometry="radiusBottom:0.67;primitive:cone" material="emissiveIntensity:0.2;emissive:#d56715" light="intensity:0;decay:0;color:#ea341a;type:point" class="scene"></a-entity>
<a-entity position="-5.403 2.592 0.072" rotation="45 0 0" id="shape2" geometry="" material="emissive:#2528b4;flatShading:true" class="scene"></a-entity>
<a-entity position="-5.403 2.592 1.493" rotation="0 0 90" id="shape1" geometry="radius:0.59;primitive:cylinder" material="emissive:#a822b7;flatShading:true"class="scene"></a-entity>
<a-entity position="-5.403 2.592 -1.376" rotation="0 0 90" id="shape3" geometry="" material="emissive:#30b821;flatShading:true"class="scene"></a-entity>
<a-entity position="4.445 0.449 -4.433" rotation="0 0 180" id="plantpot" geometry="radiusTop:0.36;radiusBottom:0.59;primitive:cone" material="roughness:0.17;color:#91562f" class="scene"></a-entity>
<a-entity position="3.825 -10 3.016" id="drawer" geometry="width:1.55;height:0.31" material="roughness:1;src:#wood" class="scene"></a-entity>
<a-entity position="4.365 0.654 -0.439" id="itemsBox" geometry="height:1.37;depth:3.84;width:1.13" material="src:#wood"></a-entity>
<a-entity position="4.415 1.429 -1.227" rotation="0 0 90" id="Lightbulb" geometry="radius:0.1;height:0.36;primitive:cylinder" material="emissiveIntensity:0.49;emissive:#ea846a;color:#ea846a" visible="false"></a-entity>
<a-entity position="4.366 1.338 0.069" id="key" geometry="height:0.0;width:0.28;depth:0.65" material="emissive:#d5cfaa;roughness:1;flatShading:true;opacity:0.89;transparent:true;src:[object HTMLImageElement]" visible="false" rotation="0 90 0"></a-entity>



  <!--the begin screen -->  <a-entity id="beginscreen" position="0 3.437 -4.736" class="scene"
                                                <a-text="" value="Title" width="11" text__titletext="zOffset:0.021;baseline:bottom;width:7.7;height:0.11;align:center;value:Title;color:#070707"
                                                text__starttext="zOffset:0.02;baseline:top;width:5.29;lineHeight:7.05;letterSpacing:0.41;align:center;wrapCount:42.22;tabSize:4.08;color:#000000;value:Stare here to start"
                                                geometry="width:2;primitive:plane;color:blue"
                                                material="color:green;emissive:green;width:512.52;flatShading:true">
                                                        <!--text="width:11; tabSize:4.82; color:#0b0b0b; align:center; value:Title"
                                                        text="width:7; tabSize:4.82; color:#0b0b0b; align:center; value:stare here to start"
                                                        geometry="primitive: plane; position: 0 -1 0" -->
                                                  &gt;</a-entity>
                              <a-entity id="FailScreen" position="0 -10 -1.5" class="scene" visible="false"
                                <a-text="" value="Title" width="11" text__titletext="value:You failed to escape;zOffset:0.021;baseline:bottom;width:7.7;height:0.11;align:center;color:#070707" text__starttext="value:Stare here to restart;zOffset:0.02;baseline:top;width:5.29;lineHeight:7.05;letterSpacing:0.41;align:center;wrapCount:42.22;tabSize:4.08;color:#000000"
                                geometry="height:1.2;width:3.17;primitive:plane"
                                material="width:512.52;emissive:red;flatShading:true;color:red">
                              &gt;</a-entity>
                              <a-entity id="WinScreen" position="0 -10 -1.5" class="scene" visible="false"
                              <a-text="" value="Title" width="11" text__titletext="value:You escaped;zOffset:0.021;baseline:bottom;width:7.7;height:0.11;align:center;color:#070707" text__starttext="value:Stare here to start again;zOffset:0.02;baseline:top;width:5.29;lineHeight:7.05;letterSpacing:0.41;align:center;wrapCount:42.22;tabSize:4.08;color:#000000"
                                      geometry="primitive:plane;height:1.2;width:3.17"
                                      material="color:green;emissive:green;width:512.52;flatShading:true">
                                      &gt;</a-entity>
  <!--Timer-->       <a-text id="timer" value="120" position="0 3.438 -4.887" text="width:12.03;color:#ff171d" align="center"></a-text>
  <!--circle hud-->  <a-entity layout="type: circle; radius: 40" position="0 0.5 0" rotation="0 10 0"></a-entity>
  <!--player -->  <a-entity position="0 1.6 0" id="player">
                  <a-camera >
                      <a-cursor fuse id="cursor" raycaster="objects: .scene"
                        animation__click="property: scale; startEvents: click; from: 0.1 0.1 0.1; to: 1 1 1; dur: 150"
                        animation__fusing="property: scale; startEvents: fusing; from: 1 1 1; to: 0.1 0.1 0.1; dur: 1500"
                        event-set__1="_event: mouseenter; color: limegreen"
                        event-set__2="_event: mouseleave; color: black">
                      </a-cursor>
                    </a-camera>
                  </a-entity>
</a-scene>

<script>
var scene = document.querySelector('a-scene');
if (scene.hasLoaded === true) { run(); } else { scene.addEventListener('loaded', run());}

function run() {    //starting logic
var beginScreen = document.querySelector('#beginscreen');
  beginScreen.addEventListener('click', function(){
    this.setAttribute('visible', 'false');
    this.setAttribute('class', 'none'); //stop overlay
    this.setAttribute('position', '0 -10 -1.5');
    setTimeout(function(){
    beginescape();
    }.bind(this), 1000);
  })
}

function beginescape() {  //begin escape logic
var timer = document.querySelector('#timer')
var PlantPot = document.querySelector('#plantpot')
var LightBulb = document.querySelector('#Lightbulb')
var Lamp = document.querySelector('#lamp')
var Drawer = document.querySelector('#drawer')
var Key = document.querySelector('#key')
var Door = document.querySelector('#door')
var Manhole = document.querySelector('#manhole')
var time = 120;
var timerpause = false;
var isLightFound = false;
var isDrawOn = false;
var IsKeyFound = false;

setInterval(SetTimer, 1000);

function SetTimer(){
  if (timerpause === true){

  }
  else if (time === 1) {
    Fail();
  }
  else {
    time = time - 1;
    timer.setAttribute('value', time);
  }
}

    PlantPot.addEventListener('click', function (){
      LightBulb.setAttribute('visible', 'true');
      isLightFound = true;
    });
    Lamp.addEventListener('click', function (){
      if (isLightFound === true){
        this.setAttribute('light', {intensity: 1});
        LightBulb.setAttribute('visible', 'false');
        Drawer.setAttribute('position', '3.825 0.906 3.016');
        isDrawOn = true;
      }
    });
    Drawer.addEventListener('click', function (){
        console.log('drawer!');

        Key.setAttribute('visible', 'true');
        IsKeyFound = true;
    
    });
    Door.addEventListener('click', function (){
      if (IsKeyFound === true){
        Fail();
      }
    });
    Manhole.addEventListener('click', function (){
      if (IsKeyFound === true){

        Win();
      }
    });

function Win (){
  var WinScreen = document.querySelector('#WinScreen')
    timerpause = true;

    WinScreen.setAttribute('visible','true');
    WinScreen.setAttribute('position', '0 3.437 -4.539');
    WinScreen.addEventListener('click', function (){
      scene.reload();
    })
    }

function Fail (){
    var FailScreen = document.querySelector('#FailScreen')
      timerpause = true;
      FailScreen.setAttribute('visible','true');
      FailScreen.setAttribute('position', '0 3.437 -4.592');
      }
    FailScreen.addEventListener('click', function (){
      scene.reload();
    })
}
</script>
</body>
</html>
