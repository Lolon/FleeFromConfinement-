<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>Flee From Confinement</title>
  <script src="aframe-v0.7.1.js"></script>
  <script src="aframe-animation-component.js"></script>
  <script src="aframe-layout-component.js"></script>
  <script src="aframe-event-set-component.js"></script>
  <script src="nunjucks.js"></script>
  <script src="aframe-template-component.js"></script>
</head>

<body>

<a-scene>
  <a-assets>
    <!--textures -->
    <img id="wall" src="assets/walls.png">
    <img id="floor" src="assets/floor.png">
    <img id="ceiling" src="assets/ceiling.png">
    <img id="Mdoor" src="assets/door.png">
    <img id="Mmanhole" src="assets/manhole.png">
    <img id="wood" src="assets/wood.png">
    <img id="Mkey" src="assets/key.png">
    <img id="blue" src="assets/woodBlue.png">
    <img id="red" src="assets/woodRed.png">
    <img id="green" src="assets/woodGreen.png">
    <img id="matress" src="assets/matress.png">
    <!-- models with their corresponding texture-->
    <a-asset-item id="OPlantPot" src="assets/models/PlantPot.obj"></a-asset-item>
    <img id="MPlantPot" src="assets/models/plantPotCol.png">
    <a-asset-item id="OLamp" src="assets/models/lamp.obj"></a-asset-item>
    <img id="Mlamp" src="assets/models/lampCol.png">
    <a-asset-item id="OLight" src="assets/models/light.obj"></a-asset-item>
    <img id="MLight" src="assets/models/lightCol.png">
    <!--sound -->
    <audio id="ambient" src="assets/sounds/water drops.mp3" ></audio>
    <audio id="SFail" src="assets/sounds/fail.mp3" ></audio>
    <audio id="lightSwitch" src="assets/sounds/light Switch.mp3" ></audio>
  <!--  <audio id="lightBuzz" src="assets/sounds/LightBuzz.mp3" ></audio> -->
    <audio id="Smanhole" src="assets/sounds/manhole.mp3" ></audio>
    <audio id="soil" src="assets/sounds/soil.mp3" ></audio>


  </a-assets>

  <!--the sky! --><a-sky color="#6EBAA7"></a-sky>
  <!--the basic room with lights and ambient music--> <a-plane color="#CCC" height="10" width="10" rotation="-90 0 0" src="#floor"></a-plane>
                        <a-plane color="#CCC" height="10" width="10" position="0 7 0" rotation="90 0 0" src="#ceiling"></a-plane>
                        <a-plane color="#CCC" height="7" width="10" position="0 3.5 -5" material="src: #wall" ></a-plane>
                        <a-plane color="#CCC" height="7" width="10" position="0 3.5 5" rotation="0 180 0" material="src: #wall"></a-plane>
                        <a-plane color="#CCC" height="7" width="10" position="-5 3.5 0" rotation="0 90 0" material="src: #wall"></a-plane>
                        <a-plane color="#CCC" height="7" width="10" position="5 3.5 0" rotation="0 -90 0" material="src: #wall"></a-plane>
                        <a-light tpe="ambient" color="#699269" position="0 -0.466 0" light="intensity:0.5;type:ambient"></a-light>
                        <a-light tpe="point" color="#fcf6c7" intensity="0.5" decay="1" distance="7" position="0 4.544 0" light="decay:1.54;distance:7.39;intensity:1;type:point;color:#83861a"></a-light>
                        <a-sound src="#ambient" position="0 0 0" loop="true" autoplay="true" volume="2"></a-sound>
                        <a-sound id="FailSound" src"#SFail" position="0 0 0" volume="2" preload="auto"></a-sound>

<!-- all the objects -->
<a-entity position="0 2.108 -5.409" id="door" geometry="width:3;height:4.32" material="roughness:0.54;src: #Mdoor" class="scene" sound="src:#SFail;volume:2"></a-entity>
<a-entity position="-1.616 0.394 3.521" id="bed" geometry="width:6.73;depth:2.98" material="roughness:1;src:#matress" class="scene"></a-entity>
<a-entity position="-3.815 -0.44 -3.87" id="manhole" geometry="primitive:cylinder" material="src: #Mmanhole; opacity: 0.9; emmisive:#0c0c0c" class="scene" sound="src:#Smanhole;volume:2"></a-entity>
<a-entity position="3.841 0.43 3.878" id="table" geometry="height:1.73;depth:2.01;width:2" material="src: #wood"></a-entity>
<a-entity position="3.56 1.3 3.63" scale="0.4 0.4 0.4" id="lamp" obj-model="obj:#OLamp" material="emissiveIntensity:0.2;src:#Mlamp" light="intensity:0;decay:0;color:#ea341a;type:point" geometry="height: 7.7; width: 3.31; depth: 2.6699999999999995" class="scene" sound="src:#lightSwitch;volume:2"></a-entity>
<a-entity position="-5.403 2.592 0.072" rotation="45 0 0" id="shape2" geometry="" material="src:#blue;flatShading:true" class="scene"></a-entity>
<a-entity position="-5.403 2.592 1.493" rotation="0 0 90" id="shape1" geometry="radius:0.59;primitive:cylinder" material="src:#red;flatShading:true"class="scene"></a-entity>
<a-entity position="-5.403 2.592 -1.376" rotation="0 0 90" id="shape3" geometry="" material="src:#green;flatShading:true"class="scene"></a-entity>
<a-entity position="4.132 -0.002 -4.065" id="plantpot" obj-model="obj:#OPlantPot" material="roughness:0.17;src:#MPlantPot" geometry="width: 0.26; depth: 0.27; height: 0.44999999999999996" class="scene" scale="5 5 5" sound="src:#soil;volume:2"></a-entity>
<a-entity position="3.825 -10 3.016" id="drawer" geometry="width:1.55;height:0.31" material="roughness:1;src:#wood" class="scene"></a-entity>
<a-entity position="4.365 0.654 -0.439" id="itemsBox" geometry="height:1.37;depth:3.84;width:1.13" material="src:#wood"></a-entity>
<a-entity position="4.415 1.307 -1.263" rotation="0 -42.16969372162859 7.333859777674538" id="Lightbulb" obj-model="obj:assets/models/light.obj" material="emissive:#680723;src:#MLight;emissiveIntensity:0.49" scale="0.1 0.1 0.1" visible="false"></a-entity>
<a-entity position="4.366 1.359 0.069" id="key" geometry="depth:0.65;height:0;width:0.28" material="src:#Mkey;emissive:#d5cfaa;roughness:1;flatShading:true;opacity:0.89;transparent:true" visible="false"rotation="0 90 0"></a-entity>


  <!--the begin screen -->  <a-entity id="beginscreen" position="0 3.437 -4.736" class="scene"
                                                <a-text="" value="Title" width="12" text__titletext="zOffset:0.021;baseline:bottom;width:7.7;height:0.11;align:center;value:FLEE FROM CONFINEMENT;color:#070707"
                                                text__starttext="zOffset:0.02;baseline:top;width:5.29;lineHeight:7.05;letterSpacing:0.41;align:center;wrapCount:42.22;tabSize:4.08;color:#000000;value:Stare here to start"
                                                geometry="width:5;primitive:plane;color:blue"
                                                material="color:green;emissive:green;width:512.52;flatShading:true">
                                                        <!--text="width:11; tabSize:4.82; color:#0b0b0b; align:center; value:Title"
                                                        text="width:7; tabSize:4.82; color:#0b0b0b; align:center; value:stare here to start"
                                                        geometry="primitive: plane; position: 0 -1 0" -->
                                                  &gt;</a-entity>
                              <a-entity id="FailScreen" position="0 -10 -1.5" class="scene" visible="false"
                                <a-text="" value="Title" width="11" text__titletext="value:YOU FAILED TO ESCAPE;zOffset:0.021;baseline:bottom;width:7.7;height:0.11;align:center;color:#070707" text__starttext="value:Stare here to restart;zOffset:0.02;baseline:top;width:5.29;lineHeight:7.05;letterSpacing:0.41;align:center;wrapCount:42.22;tabSize:4.08;color:#000000"
                                geometry="height:1.2;width:4.5;primitive:plane"
                                material="width:512.52;emissive:red;flatShading:true;color:red">
                              &gt;</a-entity>
                              <a-entity id="WinScreen" position="0 -10 -1.5" class="scene" visible="false"
                              <a-text="" value="Title" width="11" text__titletext="value:YOU ESCAPED;zOffset:0.021;baseline:bottom;width:7.7;height:0.11;align:center;color:#070707" text__starttext="value:Stare here to start again;zOffset:0.02;baseline:top;width:5.29;lineHeight:7.05;letterSpacing:0.41;align:center;wrapCount:42.22;tabSize:4.08;color:#000000"
                                      geometry="primitive:plane;height:1.2;width:3.17"
                                      material="color:green;emissive:green;width:512.52;flatShading:true">
                                      &gt;</a-entity>
  <!--Timer-->       <a-text id="timer" value="120" position="0 3.438 -4.887" text="width:12.03;color:#ff171d" align="center"></a-text>
  <!--circle hud-->  <a-entity layout="type: circle; radius: 40" position="0 0.5 0" rotation="0 10 0"></a-entity>
  <!--player -->  <a-entity position="0 0 0" id="player">
                  <a-camera >
                      <a-cursor fuse id="cursor" raycaster="objects: .scene"
                        animation__click="property: scale; startEvents: click; from: 0.1 0.1 0.1; to: 1 1 1; dur: 150"
                        animation__fusing="property: scale; startEvents: fusing; from: 1 1 1; to: 0.1 0.1 0.1; dur: 1500"
                        event-set__1="_event: mouseenter; color: limegreen"
                        event-set__2="_event: mouseleave; color: black">
                      </a-cursor>
                    </a-camera>
                  </a-entity>
</a-scene>

<script>
var scene = document.querySelector('a-scene');
if (scene.hasLoaded === true) { run(); } else { scene.addEventListener('loaded', run());}

function run() {    //starting logic
var beginScreen = document.querySelector('#beginscreen');
  beginScreen.addEventListener('click', function(){
    this.setAttribute('visible', 'false');
    this.setAttribute('class', 'none'); //stop overlay
    this.setAttribute('position', '0 -10 -1.5');
    setTimeout(function(){
    beginescape();
    }.bind(this), 1000);
  })
}

function beginescape() {  //begin escape logic
var timer = document.querySelector('#timer')
var PlantPot = document.querySelector('#plantpot')
var LightBulb = document.querySelector('#Lightbulb')
var Lamp = document.querySelector('#lamp')
var Drawer = document.querySelector('#drawer')
var EKey = document.querySelector('#key')
var EDoor = document.querySelector('#door')
var EManhole = document.querySelector('#manhole')
var time = 120;
var timerpause = false;
var isLightFound = false;
var isDrawOn = false;
var isKeyFound = false;
var isFinished = false;

setInterval(SetTimer, 1000);

function SetTimer(){
  if (timerpause === true){

  }
  else if (time === 1) {
    Fail();
  }
  else {
    time = time - 1;
    timer.setAttribute('value', time);
  }
}

    PlantPot.addEventListener('click', function (){
      if (isLightFound === false){
      LightBulb.setAttribute('visible', 'true');
      PlantPot.components.sound.playSound();
      isLightFound = true;
    }
    });
    Lamp.addEventListener('click', function (){
      if (isLightFound === true){
        this.setAttribute('light', {intensity: 1});
        LightBulb.setAttribute('visible', 'false');
        Drawer.setAttribute('position', '3.825 0.906 3.016');
        Lamp.components.sound.playSound();
        isDrawOn = true;
      }
    });
    Drawer.addEventListener('click', function (){
      if (isKeyFound === false){
        console.log('drawer!');
        EKey.setAttribute('visible', 'true');
        isKeyFound = true;
      }
    });
    EDoor.addEventListener('click', function (){
      console.log('Door!');
      if (isKeyFound === true){
        console.log('true!');
        Fail();
      }
    });
    EManhole.addEventListener('click', function (){
      console.log('manhole!');
      if (isKeyFound === true){
        console.log('true!');
        EManhole.components.sound.playSound();
        Win();
      }
    });

function Win (){
  var WinScreen = document.querySelector('#WinScreen')
  if (isFinished === true){
    timerpause = true;
    isFinished = true;
    WinScreen.setAttribute('visible','true');
    WinScreen.setAttribute('position', '0 3.437 -4.539');
    WinScreen.addEventListener('click', function (){
      scene.reload();
    })
  }
}

function Fail (){
    var FailScreen = document.querySelector('#FailScreen')
  if (isFinished === true){
      isFinished = true;
      timerpause = true;
      FailScreen.setAttribute('visible','true');
      FailScreen.setAttribute('position', '0 3.437 -4.592');
      EDoor.components.sound.playSound();
    FailScreen.addEventListener('click', function (){
      scene.reload();
    })
  }
}

</script>
</body>
</html>
